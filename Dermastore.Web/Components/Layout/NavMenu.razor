@using Dermastore.Application.DTOs
@using Dermastore.Application.Queries.Products
@using MediatR
@inject IMediator Mediator
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <a class="navbar-brand py-0" href="#">
        <img src="/assets/logo.png" height="100" alt="Dermastore Logo">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item dropdown p-3 d-flex align-items-center">
                <a class="nav-link dropdown-toggle" href="#" id="categoryDropdown" role="button" data-toggle="dropdown"
                   aria-haspopup="true" aria-expanded="false">
                    Dermastore
                </a>
                <div class="dropdown-menu bg-secondary p-4 mt-5" aria-labelledby="categoryDropdown">
                    <div class="container">
                        <div class="row">
                            <!-- Categories Section -->
                            @if (categories != null)
                            {
                                @foreach (var category in categories)
                                {
                                    <div class="col-md-3 mb-3">
                                        <h6 class="text-uppercase font-weight-bold text-white border-bottom pb-2">@category.Name</h6>
                                        <ul class="nav flex-column">
                                            @foreach (var subcategory in category.SubCategories)
                                            {
                                                <li class="nav-item">
                                                    <a class="nav-link text-tertiary py-1 hover-highlight" href="#">@subcategory.Name</a>
                                                </li>
                                            }
                                        </ul>
                                    </div>
                                }
                            }

                            <!-- Brands Section -->
                            @if (brands != null)
                            {
                                <div class="col-md-3 mb-3">
                                    <h6 class="text-uppercase font-weight-bold text-white border-bottom pb-2">Brands</h6>
                                    <ul class="nav flex-column">
                                        @foreach (var brand in brands)
                                        {
                                            <li class="nav-item">
                                                <a class="nav-link text-tertiary py-1 hover-highlight" href="#">@brand.Name</a>
                                            </li>
                                        }
                                    </ul>
                                </div>
                            }

                            <!-- Image Section -->
                            <div class="col-md-3 text-center ms-auto">
                                <div class="promo-section">
                                    <a target="_blank" href="#">
                                        <img src="/assets/NavMenuPlaceholder.png"
                                             alt="Our Latest Products" class="img-fluid rounded mb-2" style="max-height: 300px; object-fit: cover;">
                                    </a>
                                    <p class="text-white mb-0">Our Latest Products</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
        </ul>
    </div>
</nav>

<script>
    $(document).ready(function () {
        $(window).resize(function () {
            if ($(window).width() >= 980) {
                $(".navbar .dropdown-toggle").hover(function () {
                    $(this).parent().toggleClass("show");
                    $(this).parent().find(".dropdown-menu").toggleClass("show");
                });

                $(".navbar .dropdown-menu").mouseleave(function () {
                    $(this).removeClass("show");
                });
            }
        });
    });
</script>

@code {
    private IReadOnlyList<CategoryDto> categories;
    private IReadOnlyList<BrandDto> brands;

    protected override async Task OnInitializedAsync()
    {
        var categoryQuery = new GetCategoriesQuery();
        categories = await Mediator.Send(categoryQuery);

        var brandQuery = new GetBrandsQuery();
        brands = await Mediator.Send(brandQuery);
    }
}
